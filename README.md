
# ğŸ‡°ğŸ‡·Â NuriROCK(æ¨‚) - í•œêµ­ì„ ì¦ê¸°ì!

- í”„ë¡œì íŠ¸ ê¸°ê°„: 2024. 03. 08. ~ 2024. 03. 24.
- App Store ì¶œì‹œì‘ [(ë§í¬)](https://apps.apple.com/kr/app/nurirock-%E6%A8%82-%ED%95%9C%EA%B5%AD%EC%9D%84-%EC%A6%90%EA%B8%B0%EC%9E%90/id6479728531)

![nurirock](https://github.com/UngQ/NuriRock/assets/106305918/86597b10-e6ba-442d-864c-bc587e8da5f7)

## ğŸ—’ï¸Â Introduction

- í•œêµ­ì˜ ì£¼ìš” ë„ì‹œë“¤ì˜ ê´€ê´‘ì§€, ë§›ì§‘ ë“±ì„ ì‰½ê²Œ ê²€ìƒ‰í•˜ê³  ë¶ë§ˆí¬ì— ì €ì¥í•˜ì—¬ ì—¬í–‰ì— ë„ì›€ì„ ì¤„ ìˆ˜ ìˆëŠ” ì–´í”Œ
- Configuration: iOS 16.0+
- ë‹¤êµ­ì–´(í•œêµ­ì–´, ì˜ì–´) ì ìš©
- ë‹¤í¬ëª¨ë“œ ì§€ì›

## ğŸ—’ï¸Â Features

- í•œêµ­ ì£¼ìš” ë„ì‹œë³„, ê´€ê´‘ ì¹´í…Œê³ ë¦¬ë³„ ê²€ìƒ‰ ê¸°ëŠ¥
- ì›í•˜ëŠ” ë‚ ì§œì— ì§„í–‰í•˜ëŠ” ì¶•ì œ, ê³µì—°, í–‰ì‚¬ ê²€ìƒ‰ ê¸°ëŠ¥
- í‚¤ì›Œë“œë¡œ ê´€ê´‘ì§€ ê²€ìƒ‰ ë° ê¸°ë¡ ì €ì¥ ê¸°ëŠ¥
- ê´€ê´‘ì§€ ë¶ë§ˆí¬ ì €ì¥ ê¸°ëŠ¥
- ê´€ê´‘ì§€ ë””í…Œì¼ ì •ë³´ í™•ì¸ ê¸°ëŠ¥
- ìì‹ ì˜ ìœ„ì¹˜ì™€ ì„ íƒí•œ ê´€ê´‘ì§€ì˜ ê±°ë¦¬ í™•ì¸ ê¸°ëŠ¥

## ğŸ—’ï¸Â Technology Stack

- Framework
    - **Code Base UIKit**
      
- Pattern
    - **MVVM**
      - UIì™€ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì„ ë¶„ë¦¬í•˜ì—¬ ìœ ì§€ë³´ìˆ˜ì™€ í…ŒìŠ¤íŠ¸ê°€ ìš©ì´í•˜ë„ë¡ í•˜ê¸° ìœ„í•´ MVVM íŒ¨í„´ì„ ì‚¬ìš©
    
- Library
  - **ë°ì´í„°ë² ì´ìŠ¤**
    - **Realm**
      - ë°ì´í„°ì™€ UIê°„ì˜ ë™ê¸°í™” ë° ì•±ì˜ ì‘ë‹µ ì†ë„ë¥¼ í–¥ìƒì‹œí‚¤ë¥¼ ìœ„í•´ ì‚¬ìš©

  - **ë°±ì—”ë“œ ì„œë¹„ìŠ¤**
    - **Firebase**
      - ë©”ì‹œì§• ë° ì˜¤ë¥˜ ë³´ê³ ë¥¼ ìˆ˜ì§‘í•˜ê¸° ìœ„í•´ ì‚¬ìš© 

  - **ë„¤íŠ¸ì›Œí¬**
    - **Alamofire**
      - ë„¤íŠ¸ì›Œí¬ ìš”ì²­ì„ ê°„í¸í•˜ê³  íš¨ìœ¨ì ìœ¼ë¡œ ì²˜ë¦¬í•˜ê¸° ìœ„í•´ ì‚¬ìš©
        
  - **ì´ë¯¸ì§€ ì²˜ë¦¬**     
    - **Kingfisher**
      - ì´ë¯¸ì§€ë¥¼ ë‹¤ìš´ë¡œë“œí•˜ê³  ìºì‹±í•˜ëŠ” ì‘ì—…ì„ ê°„í¸í•˜ê²Œ ì²˜ë¦¬í•˜ê¸° ìœ„í•´ ì‚¬ìš©

  - **UI êµ¬ì„±**
    - **Tabman**
      - ì§ê´€ì ì´ê³  ì‚¬ìš©í•˜ê¸° ì‰¬ìš´ íƒ­ ì¸í„°í˜ì´ìŠ¤ë¥¼ ì œê³µí•˜ê¸° ìœ„í•´ ì‚¬ìš©
    - **Snapkit**
      - ì˜¤í†  ë ˆì´ì•„ì›ƒì„ ì½”ë“œë¡œ ì‰½ê²Œ ì‘ì„±í•˜ê³  ê´€ë¦¬í•˜ê¸° ìœ„í•´ ì‚¬ìš©
    - **Toast**
      - ì‚¬ìš©ìì—ê²Œ ê°„ë‹¨í•œ íŒì—… ë©”ì‹œì§€ë¥¼ í‘œì‹œí•˜ì—¬ ì¸í„°í˜ì´ìŠ¤ë¥¼ ì§ê´€ì ìœ¼ë¡œ ë§Œë“¤ê¸° ìœ„í•´ ì‚¬ìš©
    - **SVProgressHUD**
      - ë” ì§ê´€ì ìœ¼ë¡œ ë¡œë”©ì— ëŒ€í•œ HUD í‘œì‹œë¥¼ ìœ„í•´ ì‚¬ìš©
    - **FSCalendar**
      - Customizeê°€ ìš©ì´í•œ ìº˜ë¦°ë”ë¥¼ ìœ„í•´ ì‚¬ìš©
    
## ğŸ’¬ Description
### 1. ImageViewì— RxGesture ì ìš©, Double Tappedì‹œ ì¢‹ì•„ìš”ğŸ‘ğŸ»/ì‹«ì–´ìš”ğŸ‘ğŸ»
   
https://github.com/UngQ/BuyOrNot/assets/106305918/6496eae7-2f06-47cd-b9ce-7ce43137842d
- ì´ë¯¸ì§€ì˜ ê°€ìš´ë° xì¢Œí‘œë¥¼ 0ìœ¼ë¡œ ê°€ì •, ì™¼ìª½ ì˜ì—­(x < 0)ì„ ë”ë¸”íƒ­í•˜ë©´ "ì¢‹ì•„ìš”", ì˜¤ë¥¸ìª½ ì˜ì—­(x > 0)ì„ ë”ë¸”íƒ­í•˜ë©´ "ì‹«ì–´ìš”" ê¸°ëŠ¥ì´ ë™ì‘í•˜ë„ë¡ êµ¬í˜„
- ë™ì¼í•œ ì˜ì—­ì— ë‹¤ì‹œ íˆ¬í‘œí•  ê²½ìš° ê¸°ì¡´ íˆ¬í‘œë¥¼ ì·¨ì†Œ
  <details>
  <summary><b>ì£¼ìš”ì½”ë“œ</b></summary>

  ```swift
  cell.postImageView.rx.tapGesture(configuration: { gestureRecognizer, delegate in
				gestureRecognizer.numberOfTapsRequired = 2 })
			.when(.recognized)
			.subscribe(onNext: { [weak self] gesture in
				let touchPoint = gesture.location(in: gesture.view)
				if let width = gesture.view?.bounds.width {
					if touchPoint.x < width / 2 {
						likeButtonTapped.onNext(row)
						self?.playAppropriateAnimation(for: "like", likeCondition: cell.like, dislikeCondition: cell.dislike)
					} else {
						disLikeButtonTapped.onNext(row)
						self?.playAppropriateAnimation(for: "dislike", likeCondition: cell.like, dislikeCondition: cell.dislike)
					}
				}
			})
			.disposed(by: cell.disposeBag)
  ```
    
</details>

### 2. MVVMì˜ íš¨ê³¼ì ì¸ í™œìš©ë„ë¥¼ ë†’ì´ê¸° ìœ„í•œ `ViewModel` Protocl ì •ì˜
- ViewModelì˜ ì¸í„°í˜ì´ìŠ¤ë¥¼ ëª…í™•í•˜ê²Œ ì •ì˜í•˜ì—¬ ì¼ê´€ëœ êµ¬ì¡° ìœ ì§€
- Input, Output íƒ€ì…ì„ í†µí•˜ì—¬ ì…, ì¶œë ¥ ëª…í™•
- RxSwiftì˜ disposeBagì„ ì‚¬ìš©í•œ ë©”ëª¨ë¦¬ ê´€ë¦¬
  <details>
  <summary><b>ì£¼ìš”ì½”ë“œ</b></summary>

  ```swift
  protocol ViewModelType {

	associatedtype Input
	associatedtype Output

	var disposeBag: DisposeBag { get set }

	func transform(input: Input) -> Output
  }
  ```
    
</details>

### 3. Router Pattern ì ìš©í•˜ì—¬, íš¨ê³¼ì ìœ¼ë¡œ 30ê°œ ì´ìƒì˜ API í†µì‹  ê´€ë¦¬
- TargetType í”„ë¡œí† ì½œê³¼ Router ì—´ê±°í˜•ì„ ì‚¬ìš©í•˜ì—¬ ë‹¤ì–‘í•œ API ì—”ë“œí¬ì¸íŠ¸ë¥¼ ì •ì˜í•˜ê³ , ê° ìš”ì²­ì˜ ì„¸ë¶€ ì‚¬í•­ì„ ì„¤ì •
- ë„¤íŠ¸ì›Œí¬ ìš”ì²­ì„ í•˜ë‚˜ì˜ Router ì—´ê±°í˜•ìœ¼ë¡œ ê´€ë¦¬í•¨ìœ¼ë¡œì¨ ì½”ë“œì˜ ëª¨ë“ˆí™”ì™€ ì¬ì‚¬ìš©ì„±ì„ ë†’ì„
- ìƒˆë¡œìš´ API ì—”ë“œí¬ì¸íŠ¸ë¥¼ ì¶”ê°€í•  ë•Œ Router ì—´ê±°í˜•ì— ìƒˆë¡œìš´ ì¼€ì´ìŠ¤ë¥¼ ì¶”ê°€í•˜ê³  í•„ìš”í•œ ì†ì„±ì„ ì •ì˜í•˜ë©´ ë˜ë¯€ë¡œ, í™•ì¥ì„±ì´ ë›°ì–´ë‚¨
  <details>
  <summary><b>ì£¼ìš”ì½”ë“œ</b></summary>

  ```swift
  protocol TargetType: URLRequestConvertible {
	var baseURL: String { get }
	var method: HTTPMethod { get }
	var path: String { get }
	var header: [String: String] { get }
	var parameters: String? { get }
	var queryItems: [URLQueryItem]? { get }
	var body: Data? { get }
  }

  enum Router {
	case tokenRefresh
  }

  extension Router: TargetType {
      ...
  }

  ```
    
</details>

### 4. RxSwiftì˜ retry(when:)ì„ ì´ìš©í•œ í† í° ê°±ì‹  ë° í†µì‹  ì¬ì‹œë„
- ë„¤íŠ¸ì›Œí¬ ìš”ì²­ì´ AccessToken ë§Œë£Œ ì˜¤ë¥˜ì¸ HTTP ìƒíƒœ ì½”ë“œ 419ë¡œ ì‹¤íŒ¨í•  ê²½ìš°, RefreshTokenì„ ì´ìš©í•˜ì—¬ í† í°ì„ ê°±ì‹ í•˜ê³  ì›ë˜ì˜ ìš”ì²­ì„ ë‹¤ì‹œ ì‹œë„
  <details>
  <summary><b>ì£¼ìš”ì½”ë“œ</b></summary>

  ```swift
  static func performRequest<T: Decodable>(route: Router, decodingType: T.Type?) -> Single<T> {
    return Single<T>.create { single in
        do {
            let urlRequest = try route.asURLRequest()

            AF.request(urlRequest)
                .validate(statusCode: 200..<300)
                .responseDecodable(of: T.self) { response in
                    switch response.result {
                    case .success(let result):
                        single(.success(result))
                    case .failure(let error):
                        single(.failure(error))
                    }
                }
        } catch {
            single(.failure(error))
        }

        return Disposables.create()
    }
    .retry(when: { errors in
        errors.flatMap { error -> Single<Void> in
            guard let afError = error as? AFError, afError.responseCode == 419 else {
                throw error
            }
            return refreshToken().flatMap { _ in
                performRequest(route: route, decodingType: T.self).map { _ in Void() }
            }
        }
    })
  }
  ```

    - performRequest<T: Decodable>: ì£¼ì–´ì§„ ë¼ìš°íŠ¸ì— ë”°ë¼ ë„¤íŠ¸ì›Œí¬ ìš”ì²­ì„ ìˆ˜í–‰í•˜ê³ , ê²°ê³¼ë¥¼ Single<T>ë¡œ ë°˜í™˜í•©ë‹ˆë‹¤.
    - ìš”ì²­ì´ ì‹¤íŒ¨í•˜ë©´ retry(when:) ì—°ì‚°ìê°€ ì‹¤í–‰ë˜ì–´ ì˜¤ë¥˜ë¥¼ ê²€ì‚¬í•©ë‹ˆë‹¤.
    - ì˜¤ë¥˜ê°€ HTTP 419 ìƒíƒœ ì½”ë“œì¸ ê²½ìš° refreshToken() ë©”ì„œë“œë¥¼ í˜¸ì¶œí•˜ì—¬ í† í°ì„ ê°±ì‹ í•©ë‹ˆë‹¤.
    - í† í°ì´ ê°±ì‹ ë˜ë©´ ì›ë˜ì˜ ìš”ì²­ì„ ë‹¤ì‹œ ì‹œë„í•©ë‹ˆë‹¤.
    - refreshToken(): í† í° ê°±ì‹ ì„ ì²˜ë¦¬í•˜ëŠ” ë©”ì„œë“œë¡œ, ì„±ê³µì ìœ¼ë¡œ í† í°ì´ ê°±ì‹ ë˜ë©´ Single<Void>ë¥¼ ë°˜í™˜í•˜ì—¬ ì¬ì‹œë„ë¥¼ í—ˆìš©í•©ë‹ˆë‹¤. ì‹¤íŒ¨í•˜ë©´ ì˜¤ë¥˜ë¥¼ ë°œìƒì‹œì¼œ ì¬ì‹œë„ë¥¼ ì¤‘ë‹¨í•˜ê³  ë¡œê·¸ì¸ ì°½ìœ¼ë¡œ ì´ë™í•˜ë„ë¡ í•©ë‹ˆë‹¤.

    
</details>

### 5. SocketIO í™œìš©í•œ ì‹¤ì‹œê°„ ì±„íŒ… êµ¬í˜„
- ì†Œì¼“ ì—°ê²° ìƒíƒœë¥¼ ì¼ê´€ë˜ê²Œ ìœ ì§€í•˜ê¸° ìœ„í•˜ì—¬ Singleton Pattern ì ìš©
  <details>
  <summary><b>ì£¼ìš”ì½”ë“œ</b></summary>

  ```swift
  final class SocketIOManager {

	static var shared: SocketIOManager = SocketIOManager()

	var manager: SocketManager?
	var socket: SocketIOClient?

	let baseURL = URL(string: "\(APIKey.baseURL.rawValue)/v1")!

	var receivedChatData = PassthroughSubject<ChatContentModel, Never>()

	private init() {}

	func fetchSocket(roomId: String) {
		manager = SocketManager(socketURL: baseURL, config: [.log(true), .compress])

		socket = manager?.socket(forNamespace: "/chats-\(roomId)")

		socket?.on(clientEvent: .connect) { data, ack in
			print("socket connected", data, ack)
		}

		socket?.on(clientEvent: .disconnect) { data, ack in
			print("socket disconnected", data, ack)
		}

		socket?.on("chat") { dataArray, ack in
			print("chat received", dataArray, ack )

			if let data = dataArray.first {
				 do {
  					let result = try JSONSerialization.data(withJSONObject: data)
         				let decodedData = try JSONDecoder().decode(ChatContentModel.self, from: result)
  					self.receivedChatData.send(decodedData)
      				} catch {
            				print(error.localizedDescription)
       				}
			}
		}
	}

	func establishConnection() {
		socket?.connect()
	}

	func leaveConnection() {
		socket?.disconnect()
	}
  
  }
  ```
    
</details>

### 6. @propertyWrapperë¥¼ í™œìš©í•œ UserDefaults ìº¡ìŠí™”
- ìì£¼ ì‚¬ìš©ë˜ëŠ” UserDefaults ì˜ ìƒìš©êµ¬ ì½”ë“œë¥¼ ì¤„ì´ê³  ê°€ë…ì„±ì„ ë†’ì´ê¸° ìœ„í•˜ì—¬ êµ¬í˜„
- @propertyWrapper ì†ì„±ì„ ì ìš©í•œ MyDefaults êµ¬ì¡°ì²´ ìƒì„± í›„ UserDefaultsManager ì •ì˜
  <details>
  <summary><b>ì£¼ìš”ì½”ë“œ</b></summary>

  ```swift
  @propertyWrapper
  struct MyDefaults<T> {
    let key: String
    let defaultValue: T

    var wrappedValue: T {
        get {
            UserDefaults.standard.object(forKey: key) as? T ?? defaultValue
        }
        set {
            UserDefaults.standard.setValue(newValue, forKey: key)
        }
    }
  }

  enum UserDefaultsManager {

    enum Key: String {
        case userId
        ...
    }

    @MyDefaults(key: Key.userId.rawValue, defaultValue: "")
    static var userId: String
    ...
  }

  //ê¸°ì¡´ ì‚¬ìš©ë²•
  UserDefaults.standard.string(forKey: UserDefaultsKey.userId.key) ?? ""

  //ê°œì„ ëœ ì‚¬ìš©ë²•
  let myId = UserDefaultsManager.userId //get
  UserDefaultsManager.userId = "ë³€ê²½ëœë‹‰ë„¤ì„" //set
  ```
    
</details>

### 7. Reactiveë¥¼ extensioní•˜ì—¬, Cursor-based Pagination êµ¬í˜„
- Baseê°€ UIScrollView íƒ€ì…ì¸ ê²½ìš°, UIScrollViewê°€ ë°”ë‹¥ì—ì„œ 400 í¬ì¸íŠ¸ì— ë„ë‹¬í•  ë•Œë§ˆë‹¤ ì´ë²¤íŠ¸ë¥¼ ë°©ì¶œí•˜ëŠ” reachedBottom í”„ë¡œí¼í‹°ë¥¼ ì •ì˜
  <details>
  <summary><b>ì£¼ìš”ì½”ë“œ</b></summary>

  ```swift
  extension Reactive where Base: UIScrollView {
	var reachedBottom: Observable<Void> {
		return contentOffset
			.debounce(.milliseconds(100), scheduler: MainScheduler.instance)
			.flatMap { [weak base] _ -> Observable<Void> in
				guard let scrollView = base else { return .empty() }
				let contentHeight = scrollView.contentSize.height
				let scrollViewHeight = scrollView.bounds.size.height
				let scrollPosition = scrollView.contentOffset.y + scrollViewHeight
				let threshold = contentHeight - 400
				if scrollPosition >= threshold {
					return .just(())
				} else {
					return .empty()
				}
			}
	}
  }

  ```
    
</details>

## ğŸ®Â ì£¼ìš”ê¸°ëŠ¥ UI

|![á„’á…¬á„‹á…¯á†«á„€á…¡á„‹á…µá†¸-á„á…¡á†¯á„á…¬](https://github.com/UngQ/BuyOrNot/assets/106305918/bf3eac4e-b716-4d4a-a7a8-4d834992be02)|![á„Œá…¡á„ƒá…©á†¼á„…á…©á„€á…³á„‹á…µá†«](https://github.com/UngQ/BuyOrNot/assets/106305918/7e1bb436-695b-4c23-ba44-a97a26b29437)|![á„‘á…³á„…á…©á„‘á…µá†¯á„‰á…®á„Œá…¥á†¼](https://github.com/UngQ/BuyOrNot/assets/106305918/4063fbf8-b3bc-40b1-a723-f7ec3e379997)|![á„€á…¦á„‰á…µá„€á…³á†¯á„Œá…¡á†¨á„‰á…¥á†¼-á„‰á…¡á†¨á„Œá…¦](https://github.com/UngQ/BuyOrNot/assets/106305918/6abe442d-5266-4b6c-a485-2f33f7d16d1a)|
|:--:|:--:|:--:|:--:|
|íšŒì›ê°€ì… ~ íƒˆí‡´|Keychain í™œìš©í•œ ìë™ë¡œê·¸ì¸|í”„ë¡œí•„ ìˆ˜ì •|í¬ìŠ¤íŠ¸ CRUD|

|![Simulator Screen Recording - iPhone 15 Pro - 2024-05-05 at 11 05 03](https://github.com/UngQ/BuyOrNot/assets/106305918/1b06e0a5-432c-483b-8684-9a5f1dfc976a)|![á„‚á…¢á„‘á…³á„…á…©á„‘á…µá†¯](https://github.com/UngQ/BuyOrNot/assets/106305918/5cdcfa4e-f32a-4230-922a-38666f0f9891)|![á„ƒá…¡á„…á…³á†«á„‘á…³á„…á…©á„‘á…µá†¯](https://github.com/UngQ/BuyOrNot/assets/106305918/6d5e2610-a853-4ca8-9da3-99c80a76dd61)|![á„‘á…¡á†¯á„…á…©á„‹á…®](https://github.com/UngQ/BuyOrNot/assets/106305918/c0d82806-0adb-46dc-95de-a3bd31c045e7)|
|:--:|:--:|:--:|:--:|
|í¬ìŠ¤íŠ¸ ì¢‹ì•„ìš”/ì‹«ì–´ìš”|ë‚´ í”„ë¡œí•„ ì¡°íšŒ<br>(ë‚´ ê²Œì‹œê¸€, ì¢‹ì•„ìš”/ì‹«ì–´ìš”í•œ ê²Œì‹œê¸€, ê²°ì œë‚´ì—­ ì¡°íšŒ)|ë‹¤ë¥¸ ìœ ì € í”„ë¡œí•„ ì¡°íšŒ|íŒ”ë¡œìš°|

|![á„á…¡á„á…¦á„€á…©á„…á…µá„Œá…©á„’á…¬-á„‰á…¡á„‹á…­á†¼á„Œá…¡á„‡á…§á†¯á„Œá…©á„’á…¬](https://github.com/UngQ/BuyOrNot/assets/106305918/fa9d0656-0ee1-4a96-87ff-9bcaa4cdb411)|![á„ƒá…¢á†ºá„€á…³á†¯](https://github.com/UngQ/BuyOrNot/assets/106305918/13d22eb9-6ff6-4a4a-8e19-6a536a1e7209)|![Simulator Screen Recording - iPhone 15 Pro - 2024-05-05 at 20 07 20](https://github.com/UngQ/BuyOrNot/assets/106305918/c98d45f5-a6be-44a0-aa6f-3272005e1947)|
|:--:|:--:|:--:|
|ê²Œì‹œë¬¼ ì¡°íšŒ|ëŒ“ê¸€ ì‘ì„±, ì‚­ì œ, ìˆ˜ì •|ê²°ì œ ê¸°ëŠ¥|

### - ì±„íŒ… ê¸°ëŠ¥ ( Updated at 2024. 05. 24. )

|![Simulator Screen Recording - iPhone 15 Pro - 2024-05-24 at 12 38 06](https://github.com/UngQ/BuyOrNot/assets/106305918/611aa623-8a7c-48b6-b583-c4cb8e27cdeb)|![Simulator Screen Recording - iPhone 15 Pro - 2024-05-24 at 12 38 45](https://github.com/UngQ/BuyOrNot/assets/106305918/fa615597-3659-403b-821c-4577c289fee8)|
|:--:|:--:|
|ë‚´ ì±„íŒ…ë°© ëª©ë¡|ë‹¤ë¥¸ìœ ì € í”„ë¡œí•„ì—ì„œ ì±„íŒ…ë°© ì§„ì…|



![20240402_123148_1](https://github.com/UngQ/NuriRock/assets/106305918/6e012976-2ecf-48c7-b651-93d10ebc6471)


