
# ğŸ‡°ğŸ‡·Â NuriROCK(æ¨‚) - í•œêµ­ì„ ì¦ê¸°ì!

- í”„ë¡œì íŠ¸ ê¸°ê°„: 2024. 03. 08. ~ 2024. 03. 24.
- App Store ì¶œì‹œì‘ [(ë§í¬)](https://apps.apple.com/kr/app/nurirock-%E6%A8%82-%ED%95%9C%EA%B5%AD%EC%9D%84-%EC%A6%90%EA%B8%B0%EC%9E%90/id6479728531)

![nurirock](https://github.com/UngQ/NuriRock/assets/106305918/86597b10-e6ba-442d-864c-bc587e8da5f7)

## ğŸ—’ï¸Â Introduction

- í•œêµ­ì˜ ì£¼ìš” ë„ì‹œë“¤ì˜ ê´€ê´‘ì§€, ë§›ì§‘ ë“±ì„ ì‰½ê²Œ ê²€ìƒ‰í•˜ê³  ë¶ë§ˆí¬ì— ì €ì¥í•˜ì—¬ ì—¬í–‰ì— ë„ì›€ì„ ì¤„ ìˆ˜ ìˆëŠ” ì–´í”Œ
- Configuration: iOS 16.0+
- ë‹¤êµ­ì–´(í•œêµ­ì–´, ì˜ì–´) ì ìš©
- ë‹¤í¬ëª¨ë“œ ì§€ì›

## ğŸ—’ï¸Â Features

- í•œêµ­ ì£¼ìš” ë„ì‹œë³„, ê´€ê´‘ ì¹´í…Œê³ ë¦¬ë³„ ê²€ìƒ‰ ê¸°ëŠ¥
- ì›í•˜ëŠ” ë‚ ì§œì— ì§„í–‰í•˜ëŠ” ì¶•ì œ, ê³µì—°, í–‰ì‚¬ ê²€ìƒ‰ ê¸°ëŠ¥
- í‚¤ì›Œë“œë¡œ ê´€ê´‘ì§€ ê²€ìƒ‰ ë° ê¸°ë¡ ì €ì¥ ê¸°ëŠ¥
- ê´€ê´‘ì§€ ë¶ë§ˆí¬ ì €ì¥ ê¸°ëŠ¥
- ê´€ê´‘ì§€ ë””í…Œì¼ ì •ë³´ í™•ì¸ ê¸°ëŠ¥
- ìì‹ ì˜ ìœ„ì¹˜ì™€ ì„ íƒí•œ ê´€ê´‘ì§€ì˜ ê±°ë¦¬ í™•ì¸ ê¸°ëŠ¥

## ğŸ—’ï¸Â Technology Stack

- Framework
    - **Code Base UIKit**
      
- Pattern
    - **MVVM**
      - UIì™€ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì„ ë¶„ë¦¬í•˜ì—¬ ìœ ì§€ë³´ìˆ˜ì™€ í…ŒìŠ¤íŠ¸ê°€ ìš©ì´í•˜ë„ë¡ í•˜ê¸° ìœ„í•´ MVVM íŒ¨í„´ì„ ì‚¬ìš©
    
- Library
  - **ë°ì´í„°ë² ì´ìŠ¤**
    - **Realm**
      - ë°ì´í„°ì™€ UIê°„ì˜ ë™ê¸°í™” ë° ì•±ì˜ ì‘ë‹µ ì†ë„ë¥¼ í–¥ìƒì‹œí‚¤ë¥¼ ìœ„í•´ ì‚¬ìš©

  - **ë°±ì—”ë“œ ì„œë¹„ìŠ¤**
    - **Firebase**
      - ë©”ì‹œì§• ë° ì˜¤ë¥˜ ë³´ê³ ë¥¼ ìˆ˜ì§‘í•˜ê¸° ìœ„í•´ ì‚¬ìš© 

  - **ë„¤íŠ¸ì›Œí¬**
    - **Alamofire**
      - ë„¤íŠ¸ì›Œí¬ ìš”ì²­ì„ ê°„í¸í•˜ê³  íš¨ìœ¨ì ìœ¼ë¡œ ì²˜ë¦¬í•˜ê¸° ìœ„í•´ ì‚¬ìš©
        
  - **ì´ë¯¸ì§€ ì²˜ë¦¬**     
    - **Kingfisher**
      - ì´ë¯¸ì§€ë¥¼ ë‹¤ìš´ë¡œë“œí•˜ê³  ìºì‹±í•˜ëŠ” ì‘ì—…ì„ ê°„í¸í•˜ê²Œ ì²˜ë¦¬í•˜ê¸° ìœ„í•´ ì‚¬ìš©

  - **UI êµ¬ì„±**
    - **Tabman**
      - ì§ê´€ì ì´ê³  ì‚¬ìš©í•˜ê¸° ì‰¬ìš´ íƒ­ ì¸í„°í˜ì´ìŠ¤ë¥¼ ì œê³µí•˜ê¸° ìœ„í•´ ì‚¬ìš©
    - **Snapkit**
      - ì˜¤í†  ë ˆì´ì•„ì›ƒì„ ì½”ë“œë¡œ ì‰½ê²Œ ì‘ì„±í•˜ê³  ê´€ë¦¬í•˜ê¸° ìœ„í•´ ì‚¬ìš©
    - **Toast**
      - ì‚¬ìš©ìì—ê²Œ ê°„ë‹¨í•œ íŒì—… ë©”ì‹œì§€ë¥¼ í‘œì‹œí•˜ì—¬ ì¸í„°í˜ì´ìŠ¤ë¥¼ ì§ê´€ì ìœ¼ë¡œ ë§Œë“¤ê¸° ìœ„í•´ ì‚¬ìš©
    - **SVProgressHUD**
      - ë” ì§ê´€ì ìœ¼ë¡œ ë¡œë”©ì— ëŒ€í•œ HUD í‘œì‹œë¥¼ ìœ„í•´ ì‚¬ìš©
    - **FSCalendar**
      - Customizeê°€ ìš©ì´í•œ ìº˜ë¦°ë”ë¥¼ ìœ„í•´ ì‚¬ìš©
    
## ğŸ’¬ Description
### 1. Optimistic UI ì ìš©



|![Simulator Screen Recording - iPhone 15 Pro - 2024-03-30 at 11 30 43](https://github.com/user-attachments/assets/f9809f88-bee7-49e6-b78f-d9523eb5ea24)|!![Simulator Screen Recording - iPhone 15 Pro - 2024-03-31 at 17 20 56](https://github.com/user-attachments/assets/1d94bc50-3784-40ce-a854-b6a7b95dbcf1)|
|:--:|:--:|
|ì ìš© ì „|ì ìš© í›„|

- ì‚¬ìš©ì ì…ì¥ì„ ê³ ë ¤í•˜ì—¬ ë¶ë§ˆí¬ì‹œ Incidatorë¥¼ êµ¬í˜„í•˜ì˜€ì§€ë§Œ, ì˜¤íˆë ¤ ë„ˆë¬´ ì¦ì€ Indicator ë‚¨ìš©ìœ¼ë¡œ ì¸í•´ ì‚¬ìš©ìì—ê²Œ ìŠ¤íŠ¸ë ˆìŠ¤ë¥¼ ì¤„ ê²ƒ
- ê²Œë‹¤ê°€ ì´ë²ˆ í”„ë¡œì íŠ¸ì— ì‚¬ìš©í•œ í•œêµ­ê´€ê´‘ê³µì‚¬ API ëŠ” ê°€ë” ì„œë²„í†µì‹ ì´ ì˜ ì•ˆë ë•Œê°€ ìˆì–´ì„œ ì¦ì€ Indicator ëŠ” ì‚¬ìš©ì ì…ì¥ì—ì„œ ë” ë‹µë‹µí•¨
- [ê´€ë ¨ ê°œì¸ í¬ìŠ¤íŒ…](https://ungq.tistory.com/6)
  <details>
  <summary><b>ì£¼ìš”ì½”ë“œ</b></summary>

  ```swift
  @objc private func bookmarkButtonClickedInBottomCV(\_ sender: UIButton) {

    guard let data = viewModel.outputFestivalData.value?.response.body.items?.item?[sender.tag] else {
        return }
    // ë¶ë§ˆí¬ ìƒíƒœ í™•ì¸
    let isBookmarked = viewModel.repository.isBookmarked(contentId: data.contentid)

    // Optimistic UI ì—…ë°ì´íŠ¸
    sender.setImage(UIImage(systemName: isBookmarked ? "bookmark" : "bookmark.fill"), for: .normal)

    // ë¶ë§ˆí¬ ìƒíƒœì— ë”°ë¼ ë¶ë§ˆí¬ ì¶”ê°€ ë˜ëŠ” ì‚­ì œ
    if isBookmarked {
        viewModel.repository.deleteBookmark(data: data)
        // ì‚­ì œ í›„ UI ì—…ë°ì´íŠ¸ í•„ìš” ì—†ìŒ
    } else {
        viewModel.repository.addBookmark(id: data.contentid) { success in
            DispatchQueue.main.async {
                if !success {
                    // ìš”ì²­ ì‹¤íŒ¨ ì‹œ UI ë˜ëŒë¦¬ê¸°
                    sender.setImage(UIImage(systemName: "bookmark"), for: .normal)
                    // ì‹¤íŒ¨ í”¼ë“œë°± ì œê³µ
                }
            }
        }
    }
  ```
    
</details>

### 2. accessibilityIdentifierì„ í™œìš©í•œ DiffableDatasource + Realm êµ¬í˜„
- ë¶ë§ˆí¬ ì‚­ì œì‹œ Button.tagë“¤ì€ ê¸°ì¡´ tag ê°’ë“¤ì„ ê·¸ëŒ€ë¡œ ê°€ì§€ê³  ìˆì–´ì„œ Itemë“¤ì˜ row ê°’ê³¼ tag ê°’ì˜ ë¶ˆì¼ì¹˜ ë°œìƒ
- indexPath ê¸°ë°˜ì´ ì•„ë‹Œ, identifierì„ ì´ìš©í•˜ì—¬ ì…€ ì‚­ì œ ê¸°ëŠ¥ì„ êµ¬í˜„í•˜ë‹ˆ, tag ë¶ˆì¼ì¹˜, ì• ë‹ˆë©”ì´ì…˜ íš¨ê³¼ ë“± ëª¨ë“  ë¬¸ì œì ì´ í•´ê²° ë˜ì—ˆìœ¼ë©° DiffableDatasourceì— ë” íš¨ìœ¨ì 
  <details>
  <summary><b>ì£¼ìš”ì½”ë“œ</b></summary>

  ```swift

    //ê¸°ì¡´ ì½”ë“œ
    private func configureDataSource() {
        let cellRegistration = UICollectionView.CellRegistration<ResultCollectionViewCell, Bookmark> { (cell, indexPath, identifier) in
            cell.updateUIInBookmarkVC(identifier)

            cell.bookmarkButton.tag = indexPath.item
            cell.bookmarkButton.addTarget(self, action: #selector(self.bookmarkButtonClicked), for: .touchUpInside)
            cell.bookmarkButton.setImage(UIImage(systemName: "bookmark.fill"), for: .normal)

            ...
    }

    @objc private func bookmarkButtonClicked(_ sender: UIButton) {
        viewModel.repository.deleteBookmarkInBookmarkView(data: Array(viewModel.outputBookmarks.value ?? [])[sender.tag])

    }

    private func updateSnapshot() {
        var snapshot = NSDiffableDataSourceSnapshot<Section, Bookmark>()

        snapshot.appendSections([.main])

        let bookmarks = viewModel.outputBookmarks.value ?? []

        snapshot.appendItems(bookmarks, toSection: .main)

        dataSource.apply(snapshot, animatingDifferences: true) //reloadData
        self.updateMapView(with: bookmarks)

        DispatchQueue.main.asyncAfter(deadline: .now() + 0.3){
            self.bookmarkCollectionView.reloadData()
        }
    }

    //ë³€ê²½ ì½”ë“œ
    cell.bookmarkButton.accessibilityIdentifier = identifier.contentid
  ```
    
</details>

### 3. í•œêµ­ê´€ê´‘ê³µì‚¬ API ì„œë²„ ìƒíƒœ ë¶ˆì•ˆì •ìœ¼ë¡œ ì¸í•œ ë„¤íŠ¸ì›Œí¬ í†µì‹  ì‹¤íŒ¨ì‹œ, ì¬í˜¸ì¶œ êµ¬í˜„
- ì„œë²„ê°€ ë¶ˆì•ˆì •í•˜ì—¬ ì‹œê°„ëŒ€ì— ë”°ë¼, ê°™ì€ Parameterë¡œ í˜¸ì¶œì„ í•˜ì—¬ë„ ë„¤íŠ¸ì›Œí¬ í†µì‹ ì´ ì‹¤íŒ¨í•˜ëŠ” ê²½ìš°ê°€ ì¦ìŒ (í‰ê·  ìƒˆë²½ì—ëŠ” 3ë²ˆ í˜¸ì¶œì‹œ 1ë²ˆ ì‹¤íŒ¨, ì˜¤í›„ì—ëŠ” 100ë²ˆ í˜¸ì¶œì‹œ 1ë²ˆ ì‹¤íŒ¨)
- Errorí™•ì¸ ê²°ê³¼, Routing Error ë¡œ í™•ì¸ë˜ì—ˆìœ¼ë©° ì œê°€ ì•„ë‹Œ Serverì—ì„œ í•´ê²°í•´ì¤˜ì•¼ í•˜ëŠ” ë¬¸ì œ (í•œêµ­ê´€ê´‘ê³µì‚¬ APIë¥¼ ì œê³µí•´ì£¼ëŠ” ê³µê³µë°ì´í„°í¬í„¸ì— ë¬¸ì˜í•´ë³´ì•˜ì§€ë§Œ, ì´ ë¬¸ì œë¥¼ ì¸ì§€í•˜ê³  ìˆìœ¼ë‚˜ ë‹¹ì¥ì€ í•´ê²°í•˜ì§€ ëª» í•œë‹¤ëŠ” ë‹µë³€)
- í˜¸ì¶œì‹œ, ì¬ì‹œë„ íšŸìˆ˜ë¥¼ ì„¤ì • (retryCount) 
- ì‹¤íŒ¨í•  ê²½ìš°, 3ì´ˆì˜ ê°„ê²©ì„ ë‘ê³  retryCountë¥¼ 1ì”© ì°¨ê°í•˜ë©° ì¬í˜¸ì¶œí•˜ê²Œ êµ¬í˜„
- retryCountë¥¼ ëª¨ë‘ ì°¨ê°í•˜ê³ ë„ ì‹¤íŒ¨í•  ê²½ìš°ëŠ” ì„œë²„ê°€ ì‘ë™ì´ ì•ˆë˜ëŠ” ì‹œì ìœ¼ë¡œ ê°„ì£¼í•˜ì—¬, completionHandlerë¥¼ í™œìš©í•˜ì—¬ Viewì—ì„œ ë‚˜ì¤‘ì— ì¬ì‹œë„ í•˜ë¼ëŠ” Alertì„ ë„ìš°ë„ë¡ êµ¬í˜„
  <details>
  <summary><b>ì£¼ìš”ì½”ë“œ</b></summary>

  ```swift
  	func request<T: Decodable>(type: T.Type, api: API, retryCount: Int = 2, completionHandler: @escaping (T?, AFError?) -> Void) {

		session.request(api.endPoint,
					 method: api.method,
					 parameters: api.parameter,
					 encoding: api.encoding).responseDecodable(of: T.self) { response in
			switch response.result {
			case .success(let success):
				print("ë„¤íŠ¸ì›Œí¬ í†µì‹  ì„±ê³µ!")
				completionHandler(success, nil)
			case .failure(let failure):
				print("ì—ëŸ¬")
				if retryCount > 0 {

					DispatchQueue.main.asyncAfter(deadline: .now()) {
						self.request(type: type, api: api, retryCount: retryCount - 1, completionHandler: completionHandler)
						print(retryCount)
					}
				} else {
					print("ì—¬ê¸°ë¡œì˜¤ë‚˜")
					completionHandler(nil, failure)
				}

			}
		}
	}
  ```
    
</details>


## ğŸ®Â ì£¼ìš”ê¸°ëŠ¥ UI

|![nurirock-launchscreen](https://github.com/user-attachments/assets/6e3deacc-b9aa-4a5b-aa41-a66725413e5f)|![nurirock-citychange](https://github.com/user-attachments/assets/c50c8699-90e5-4326-802c-369eef503544)|![nurirock-contentchange](https://github.com/user-attachments/assets/dddf256a-d16c-405d-9697-c7f4aadb8f88)|![nurirock-event](https://github.com/user-attachments/assets/f1a69541-6c26-4788-a474-55496eac9a24)|
|:--:|:--:|:--:|:--:|
|animate í™œìš©í•œ ëŸ°ì¹˜ìŠ¤í¬ë¦°|ë„ì‹œë³„ ê²€ìƒ‰|ì»¨í…ì¸ ë³„ ê²€ìƒ‰|ë‚ ì§œë³„ í–‰ì‚¬ ê²€ìƒ‰|

|![nurirock-keyword](https://github.com/user-attachments/assets/3be76476-63bc-4046-8e17-521a74f504aa)|![nurirock-bookmark](https://github.com/user-attachments/assets/6fe4446c-251e-4fa9-acea-1e2840ef62c1)|![nurirock-detail](https://github.com/user-attachments/assets/da5ec4f0-b0ee-4b4b-b371-a368b541264e)|
|:--:|:--:|:--:|
|í‚¤ì›Œë“œ ê²€ìƒ‰|ë¶ë§ˆí¬ ì €ì¥|ì„¸ë¶€ì‚¬í•­ ì¡°íšŒ|


## í”„ë¡œì íŠ¸ ì†Œê°œ ë° ë°œí‘œ
![20240402_123148_1](https://github.com/UngQ/NuriRock/assets/106305918/6e012976-2ecf-48c7-b651-93d10ebc6471)


